# Construct covariance matrix
Sigma <- matrix(r, nrow = k, ncol = k)
diag(Sigma) <- 1
Sigma <- diag(sqrt(var_vec)) %*% Sigma %*% diag(sqrt(var_vec))
# Simulate data
Y <- MASS::mvrnorm(n, eff, Sigma)
dat <- list(y = Y, N = nrow(Y), k = ncol(Y))
apply(Y, 2, mean)
# Stan model code
mod_code <- "
data {
int<lower=0> k;
int<lower=0> N;
vector[k] y[N];
}
parameters {
vector[k] mu;
cov_matrix[k] Sigma;
}
model {
mu ~ normal(0, 1.5);
Sigma ~ inv_wishart(k + 2, diag_matrix(rep_vector(1, k)));
for (n in 1:N) {
y[n] ~ multi_normal(mu, Sigma);
}
}
"
# Fit model
fit <- rstan::stan(model_code = mod_code, data = dat, iter = 6000, chains = 4, refresh = 0)
df_fit <- as.data.frame(fit)
colnames(df_fit) <- c("visuo","spat",colnames(df_fit)[3:7])
mean(df_fit$visuo > 0)
mean(df_fit$spat > 0)
mean(df_fit$visuo > 0 & df_fit$spat >0)
# Extract posterior samples for mu
post_mu <- df_fit[, grep("^mu\\[", colnames(df_fit))]
# Compute posterior means and covariance
mu_post <- colMeans(post_mu[, 1:2])
sigma_post <- cov(post_mu[, 1:2])
# Compute ellipse for 95% credible region
ellipse_coords <- ellipse(sigma_post, centre = mu_post, level = 1 - alpha)
post = cbind(df_fit[,1:2])
colnames(post) <- c("visuo","spat")
mean(df_fit$visuo > 0)
mean(df_fit$spat > 0)
mean(df_fit$visuo > 0 & df_fit$spat >0)
# Extract posterior samples for mu
post_mu <- df_fit[, grep("^mu\\[", colnames(df_fit))]
# Compute posterior means and covariance
mu_post <- colMeans(post_mu[, 1:2])
df_fit <- as.data.frame(fit)
post = cbind(df_fit[,1:2])
colnames(post) <- c("visuo","spat")
mean(df_fit$visuo > 0)
mean(df_fit$spat > 0)
mean(df_fit$visuo > 0 & df_fit$spat >0)
df_fit <- as.data.frame(fit)
post = cbind(df_fit[,1:2])
colnames(post) <- c("visuo","spat")
mean(df_fit$visuo > 0)
post = data.frame(visuo = df_fit[,1], spat = df_fit[,2])
mean(post$visuo > 0)
mean(post$spat > 0)
mean(post$visuo > 0 & post$spat >0)
# Extract posterior samples for mu
post_mu <- df_fit[, grep("^mu\\[", colnames(df_fit))]
# Compute posterior means and covariance
mu_post <- colMeans(post_mu[, 1:2])
sigma_post <- cov(post_mu[, 1:2])
# Compute ellipse for 95% credible region
ellipse_coords <- ellipse(sigma_post, centre = mu_post, level = 1 - alpha)
ellipse_df <- as.data.frame(ellipse_coords)
colnames(ellipse_df) <- c("x", "y")
# Compute marginal credible intervals (95%)
ci_theta1 <- quantile(post_mu[, 1], probs = c(alpha/2, 1 - alpha/2))
ci_theta2 <- quantile(post_mu[, 2], probs = c(alpha/2, 1 - alpha/2))
ci_theta2
# Project the actual ellipse onto each axis
ellipse_proj_theta1 <- c(min(ellipse_df$x), max(ellipse_df$x))
ellipse_proj_theta2 <- c(min(ellipse_df$y), max(ellipse_df$y))
# Prepare data frame
plot_data <- data.frame(
theta1 = post_mu[, 1],
theta2 = post_mu[, 2]
)
# Get density info
dens_theta1 <- density(plot_data$theta1)
dens_theta2 <- density(plot_data$theta2)
# Calculate axis limits manually with some padding
x_padding <- diff(range(plot_data$theta1)) * 0.05
y_padding <- diff(range(plot_data$theta2)) * 0.05
x_lim <- range(plot_data$theta1) + c(-x_padding, x_padding)
y_lim <- range(plot_data$theta2) + c(-y_padding, y_padding)
# DEBUG: Print the values
cat("X limits:", x_lim, "\n")
cat("Y limits:", y_lim, "\n")
cat("Ellipse proj theta1:", ellipse_proj_theta1, "\n")
cat("Ellipse proj theta2:", ellipse_proj_theta2, "\n")
# Main plot
p_main <- ggplot(plot_data, aes(x = theta1, y = theta2)) +
geom_point(alpha = 0.1, size = 1) +
geom_path(data = ellipse_df, aes(x = x, y = y), color = "red",
linewidth = 1.5) +
geom_vline(xintercept = 0, linetype = "dashed", color = "darkblue",
linewidth = 1.2) +
geom_hline(yintercept = 0, linetype = "dashed",
color = "dodgerblue1",
linewidth = 1.2) +
geom_abline(intercept = 0, slope = 1, linetype = "dashed",
color = "cyan2",
linewidth = 1.2) +
annotate(geom = "point", x = 0, y = 0, size = 3) +
scale_x_continuous(limits = x_lim, expand = c(0, 0)) +
scale_y_continuous(limits = y_lim, expand = c(0, 0)) +
labs(x = expression(theta[1]),
y = expression(theta[2])) +
theme_bw(base_size = 18) +
theme(plot.margin = unit(c(0, 0, 0, 0), "pt"))
# Top marginal
p_top <- ggplot(plot_data, aes(x = theta1)) +
geom_density(fill = "#2C7BB9", color = "black", alpha=0.8) +
geom_segment(aes(x = ellipse_proj_theta1[1], xend = ellipse_proj_theta1[1],
y = 0, yend = .8), linewidth = 3,
color = "red") +
geom_segment(aes(x = ellipse_proj_theta1[2], xend = ellipse_proj_theta1[2],
y = 0, yend = .8), linewidth = 3,
color = "red") +
geom_segment(aes(x = ci_theta1[1], xend = ci_theta1[1],
y = 0, yend = .8), linewidth = 3,
color = "black") +
geom_segment(aes(x = ci_theta1[2], xend = ci_theta1[2],
y = 0, yend = .8), linewidth = 3,
color = "black") +
scale_x_continuous(limits = x_lim, expand = c(0, 0)) +
scale_y_continuous(expand = c(0, 0)) +
theme_void(base_size = 20) +
theme(axis.text = element_blank(),
axis.ticks = element_blank(),
axis.title = element_blank(),
panel.grid = element_blank(),
plot.margin = unit(c(0, 0, 0, 0), "pt"))
# Right marginal
p_right <- ggplot(plot_data, aes(x = theta2)) +
geom_density(fill = "#2C7BB9", color = "black", alpha=0.8) +
geom_segment(aes(x = ellipse_proj_theta2[1], xend = ellipse_proj_theta2[1],
y = 0, yend = .8), linewidth = 3,
color = "red") +
geom_segment(aes(x = ellipse_proj_theta2[2], xend = ellipse_proj_theta2[2],
y = 0, yend = .8), linewidth = 3,
color = "red") +
geom_segment(aes(x = ci_theta2[1], xend = ci_theta2[1],
y = 0, yend = .8), linewidth = 3,
color = "black") +
geom_segment(aes(x = ci_theta2[2], xend = ci_theta2[2],
y = 0, yend = .8), linewidth = 3,
color = "black") +
scale_x_continuous(limits = y_lim, expand = c(0, 0)) +
scale_y_continuous(expand = c(0, 0)) +
coord_flip() +
theme_void(base_size = 20) +
theme(axis.text = element_blank(),
axis.ticks = element_blank(),
axis.title = element_blank(),
panel.grid = element_blank(),
plot.margin = unit(c(0, 0, 0, 0), "pt"))
# Empty
p_empty <- ggplot() + theme_void()
# Combine
layout <- "
AB
CD
"
final_plot <- p_top + p_empty + p_main + p_right +
plot_layout(design = layout, widths = c(4, 1), heights = c(1, 4)) +
plot_annotation(title = " ",
theme = theme(plot.title = element_text(size = 20, face = "bold", hjust = 0.5)))
print(final_plot)
# Project the actual ellipse onto each axis
ellipse_proj_theta1 <- c(min(ellipse_df$x), max(ellipse_df$x))
ellipse_proj_theta1
ellipse_proj_theta2
# Set parameters
r <- 0.3
var_vec <- c(1.2, .6)
eff <- c(0.25, 0.12)
n <- 200
k <- 2
alpha <- 0.05
# Construct covariance matrix
Sigma <- matrix(r, nrow = k, ncol = k)
diag(Sigma) <- 1
Sigma <- diag(sqrt(var_vec)) %*% Sigma %*% diag(sqrt(var_vec))
# Simulate data
Y <- MASS::mvrnorm(n, eff, Sigma)
dat <- list(y = Y, N = nrow(Y), k = ncol(Y))
apply(Y, 2, mean)
# Set parameters
r <- 0.3
var_vec <- c(1.2, .6)
eff <- c(0.25, 0.12)
n <- 200
k <- 2
alpha <- 0.05
# Construct covariance matrix
Sigma <- matrix(r, nrow = k, ncol = k)
diag(Sigma) <- 1
Sigma <- diag(sqrt(var_vec)) %*% Sigma %*% diag(sqrt(var_vec))
# Simulate data
Y <- MASS::mvrnorm(n, eff, Sigma)
dat <- list(y = Y, N = nrow(Y), k = ncol(Y))
apply(Y, 2, mean)
# Set parameters
r <- 0.3
var_vec <- c(1.2, .6)
eff <- c(0.25, 0.12)
n <- 200
k <- 2
alpha <- 0.05
# Construct covariance matrix
Sigma <- matrix(r, nrow = k, ncol = k)
diag(Sigma) <- 1
Sigma <- diag(sqrt(var_vec)) %*% Sigma %*% diag(sqrt(var_vec))
# Simulate data
Y <- MASS::mvrnorm(n, eff, Sigma)
dat <- list(y = Y, N = nrow(Y), k = ncol(Y))
apply(Y, 2, mean)
# Set parameters
r <- 0.3
var_vec <- c(1.2, .6)
eff <- c(0.25, 0.12)
n <- 200
k <- 2
alpha <- 0.05
# Construct covariance matrix
Sigma <- matrix(r, nrow = k, ncol = k)
diag(Sigma) <- 1
Sigma <- diag(sqrt(var_vec)) %*% Sigma %*% diag(sqrt(var_vec))
# Simulate data
Y <- MASS::mvrnorm(n, eff, Sigma)
dat <- list(y = Y, N = nrow(Y), k = ncol(Y))
apply(Y, 2, mean)
# Set parameters
r <- 0.3
var_vec <- c(1.2, .6)
eff <- c(0.25, 0.12)
n <- 200
k <- 2
alpha <- 0.05
# Construct covariance matrix
Sigma <- matrix(r, nrow = k, ncol = k)
diag(Sigma) <- 1
Sigma <- diag(sqrt(var_vec)) %*% Sigma %*% diag(sqrt(var_vec))
# Simulate data
Y <- MASS::mvrnorm(n, eff, Sigma)
dat <- list(y = Y, N = nrow(Y), k = ncol(Y))
apply(Y, 2, mean)
# Set parameters
r <- 0.3
var_vec <- c(1.2, .6)
eff <- c(0.25, 0.12)
n <- 200
k <- 2
alpha <- 0.05
# Construct covariance matrix
Sigma <- matrix(r, nrow = k, ncol = k)
diag(Sigma) <- 1
Sigma <- diag(sqrt(var_vec)) %*% Sigma %*% diag(sqrt(var_vec))
# Simulate data
Y <- MASS::mvrnorm(n, eff, Sigma)
dat <- list(y = Y, N = nrow(Y), k = ncol(Y))
apply(Y, 2, mean)
# Set parameters
r <- 0.3
var_vec <- c(1.2, .6)
eff <- c(0.25, 0.12)
n <- 200
k <- 2
alpha <- 0.05
# Construct covariance matrix
Sigma <- matrix(r, nrow = k, ncol = k)
diag(Sigma) <- 1
Sigma <- diag(sqrt(var_vec)) %*% Sigma %*% diag(sqrt(var_vec))
# Simulate data
Y <- MASS::mvrnorm(n, eff, Sigma)
dat <- list(y = Y, N = nrow(Y), k = ncol(Y))
apply(Y, 2, mean)
# Stan model code
mod_code <- "
data {
int<lower=0> k;
int<lower=0> N;
vector[k] y[N];
}
parameters {
vector[k] mu;
cov_matrix[k] Sigma;
}
model {
mu ~ normal(0, 1.5);
Sigma ~ inv_wishart(k + 2, diag_matrix(rep_vector(1, k)));
for (n in 1:N) {
y[n] ~ multi_normal(mu, Sigma);
}
}
"
# Fit model
fit <- rstan::stan(model_code = mod_code, data = dat, iter = 6000, chains = 4, refresh = 0)
df_fit <- as.data.frame(fit)
post = data.frame(visuo = df_fit[,1], spat = df_fit[,2])
mean(post$visuo > 0)
mean(post$spat > 0)
mean(post$visuo > 0 & post$spat >0)
# Extract posterior samples for mu
post_mu <- df_fit[, grep("^mu\\[", colnames(df_fit))]
# Compute posterior means and covariance
mu_post <- colMeans(post_mu[, 1:2])
sigma_post <- cov(post_mu[, 1:2])
# Compute ellipse for 95% credible region
ellipse_coords <- ellipse(sigma_post, centre = mu_post, level = 1 - alpha)
ellipse_df <- as.data.frame(ellipse_coords)
colnames(ellipse_df) <- c("x", "y")
# Compute marginal credible intervals (95%)
ci_theta1 <- quantile(post_mu[, 1], probs = c(alpha/2, 1 - alpha/2))
ci_theta2 <- quantile(post_mu[, 2], probs = c(alpha/2, 1 - alpha/2))
ci_theta2
# Project the actual ellipse onto each axis
ellipse_proj_theta1 <- c(min(ellipse_df$x), max(ellipse_df$x))
ellipse_proj_theta2 <- c(min(ellipse_df$y), max(ellipse_df$y))
# Prepare data frame
plot_data <- data.frame(
theta1 = post_mu[, 1],
theta2 = post_mu[, 2]
)
# Get density info
dens_theta1 <- density(plot_data$theta1)
dens_theta2 <- density(plot_data$theta2)
# Calculate axis limits manually with some padding
x_padding <- diff(range(plot_data$theta1)) * 0.05
y_padding <- diff(range(plot_data$theta2)) * 0.05
x_lim <- range(plot_data$theta1) + c(-x_padding, x_padding)
y_lim <- range(plot_data$theta2) + c(-y_padding, y_padding)
# DEBUG: Print the values
cat("X limits:", x_lim, "\n")
cat("Y limits:", y_lim, "\n")
cat("Ellipse proj theta1:", ellipse_proj_theta1, "\n")
cat("Ellipse proj theta2:", ellipse_proj_theta2, "\n")
# Main plot
p_main <- ggplot(plot_data, aes(x = theta1, y = theta2)) +
geom_point(alpha = 0.1, size = 1) +
geom_path(data = ellipse_df, aes(x = x, y = y), color = "red",
linewidth = 1.5) +
geom_vline(xintercept = 0, linetype = "dashed", color = "darkblue",
linewidth = 1.2) +
geom_hline(yintercept = 0, linetype = "dashed",
color = "dodgerblue1",
linewidth = 1.2) +
geom_abline(intercept = 0, slope = 1, linetype = "dashed",
color = "cyan2",
linewidth = 1.2) +
annotate(geom = "point", x = 0, y = 0, size = 3) +
scale_x_continuous(limits = x_lim, expand = c(0, 0)) +
scale_y_continuous(limits = y_lim, expand = c(0, 0)) +
labs(x = expression(theta[1]),
y = expression(theta[2])) +
theme_bw(base_size = 18) +
theme(plot.margin = unit(c(0, 0, 0, 0), "pt"))
# Top marginal
p_top <- ggplot(plot_data, aes(x = theta1)) +
geom_density(fill = "#2C7BB9", color = "black", alpha=0.8) +
geom_segment(aes(x = ellipse_proj_theta1[1], xend = ellipse_proj_theta1[1],
y = 0, yend = .8), linewidth = 3,
color = "red") +
geom_segment(aes(x = ellipse_proj_theta1[2], xend = ellipse_proj_theta1[2],
y = 0, yend = .8), linewidth = 3,
color = "red") +
geom_segment(aes(x = ci_theta1[1], xend = ci_theta1[1],
y = 0, yend = .8), linewidth = 3,
color = "black") +
geom_segment(aes(x = ci_theta1[2], xend = ci_theta1[2],
y = 0, yend = .8), linewidth = 3,
color = "black") +
scale_x_continuous(limits = x_lim, expand = c(0, 0)) +
scale_y_continuous(expand = c(0, 0)) +
theme_void(base_size = 20) +
theme(axis.text = element_blank(),
axis.ticks = element_blank(),
axis.title = element_blank(),
panel.grid = element_blank(),
plot.margin = unit(c(0, 0, 0, 0), "pt"))
# Right marginal
p_right <- ggplot(plot_data, aes(x = theta2)) +
geom_density(fill = "#2C7BB9", color = "black", alpha=0.8) +
geom_segment(aes(x = ellipse_proj_theta2[1], xend = ellipse_proj_theta2[1],
y = 0, yend = .8), linewidth = 3,
color = "red") +
geom_segment(aes(x = ellipse_proj_theta2[2], xend = ellipse_proj_theta2[2],
y = 0, yend = .8), linewidth = 3,
color = "red") +
geom_segment(aes(x = ci_theta2[1], xend = ci_theta2[1],
y = 0, yend = .8), linewidth = 3,
color = "black") +
geom_segment(aes(x = ci_theta2[2], xend = ci_theta2[2],
y = 0, yend = .8), linewidth = 3,
color = "black") +
scale_x_continuous(limits = y_lim, expand = c(0, 0)) +
scale_y_continuous(expand = c(0, 0)) +
coord_flip() +
theme_void(base_size = 20) +
theme(axis.text = element_blank(),
axis.ticks = element_blank(),
axis.title = element_blank(),
panel.grid = element_blank(),
plot.margin = unit(c(0, 0, 0, 0), "pt"))
# Empty
p_empty <- ggplot() + theme_void()
# Combine
layout <- "
AB
CD
"
final_plot <- p_top + p_empty + p_main + p_right +
plot_layout(design = layout, widths = c(4, 1), heights = c(1, 4)) +
plot_annotation(title = " ",
theme = theme(plot.title = element_text(size = 20, face = "bold", hjust = 0.5)))
print(final_plot)
names(ci95) = c("lw","up")
# 95% central credible interval from the posterior sample
ci95 <- quantile(h1$den, probs = c(0.025, 0.975))
h1 = data.frame(den = rnorm(n = 1e6, mean = .1, sd = .05))
# 95% central credible interval from the posterior sample
ci95 <- quantile(h1$den, probs = c(0.025, 0.975))
ci95 <- as.data.frame(ci95)
h1|>
ggplot(aes(x = den)) +
# density with conditional fill along x
geom_density(
aes(fill = after_stat(ifelse(between(x, -.5, 0), "highlight", "base"))),
color = "black", linewidth = 1, alpha = 0.8
) +
geom_segment(
data = ci95,
inherit.aes = FALSE,
aes(x = lw, xend = up, y = 0, yend = 0),
color = "blue3",
linewidth = 2
) +
xlab("stroop effect")+
scale_fill_manual(values = c(base = "#2C7BB9", highlight = "lightblue"), guide = "none") +
scale_x_continuous(breaks = round(seq(-.2,.4, 0.1),2), limits = c(-.2, .4)) +
theme_classic(base_size = 20)+
geom_text(
aes(x = 0.3, y = 2,
label = paste0("Pd = 0.975")),
size = 12,
color = "#2C7BB9"
)+
ylab("density")
# 95% central credible interval from the posterior sample
ci95 <- quantile(h1$den, probs = c(0.025, 0.975))
names(ci95) = c("lw","up")
ci95 <- data.frame(ci95)
View(ci95)
# 95% central credible interval from the posterior sample
ci95 <- data.frame(quantile(h1$den, probs = c(0.025, 0.975)))
View(ci95)
# 95% central credible interval from the posterior sample
ci95 <- quantile(h1$den, probs = c(0.025, 0.975))
ci95 <- data.frame(lw = ci95[1],up = ci95[2])
h1|>
ggplot(aes(x = den)) +
# density with conditional fill along x
geom_density(
aes(fill = after_stat(ifelse(between(x, -.5, 0), "highlight", "base"))),
color = "black", linewidth = 1, alpha = 0.8
) +
geom_segment(
data = ci95,
inherit.aes = FALSE,
aes(x = lw, xend = up, y = 0, yend = 0),
color = "blue3",
linewidth = 2
) +
xlab("stroop effect")+
scale_fill_manual(values = c(base = "#2C7BB9", highlight = "lightblue"), guide = "none") +
scale_x_continuous(breaks = round(seq(-.2,.4, 0.1),2), limits = c(-.2, .4)) +
theme_classic(base_size = 20)+
geom_text(
aes(x = 0.3, y = 2,
label = paste0("Pd = 0.975")),
size = 12,
color = "#2C7BB9"
)+
ylab("density")
View(ci95)
h1|>
ggplot(aes(x = den)) +
# density with conditional fill along x
geom_density(
aes(fill = after_stat(ifelse(between(x, -.5, 0), "highlight", "base"))),
color = "black", linewidth = 1, alpha = 0.8
)
source("~/Mar-Cald.github.io/footer.html")
source("~/Mar-Cald.github.io/footer.html")
source("~/Mar-Cald.github.io/footer.html")
source("~/Mar-Cald.github.io/footer.html")
source("~/Mar-Cald.github.io/footer.html")
source("~/Mar-Cald.github.io/footer.html")
source("~/Mar-Cald.github.io/footer.html")
source("~/Mar-Cald.github.io/footer.html")
source("~/Mar-Cald.github.io/footer.html")
source("~/Mar-Cald.github.io/footer.html")
source("~/Mar-Cald.github.io/footer.html")
